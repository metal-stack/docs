<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>SONiC Support · metal-stack</title><script data-outdated-warner src="../../../../assets/warner.js"></script><link rel="canonical" href="https://docs.metal-stack.io/development/proposals/MEP10/README/"/><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.039/juliamono-regular.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.11/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../../../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../../../assets/documenter.js"></script><script src="../../../../siteinfo.js"></script><script src="../../../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../../../assets/themeswap.js"></script><link href="../../../../assets/favicon.ico" rel="icon" type="image/x-icon"/><link href="../../../../assets/youtube.css" rel="stylesheet" type="text/css"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../../../"><img src="../../../../assets/logo.svg" alt="metal-stack logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../../../">metal-stack</a></span></div><form class="docs-search" action="../../../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../../../">Introduction</a></li><li><span class="tocitem">Overview</span><ul><li><a class="tocitem" href="../../../../overview/architecture/">Architecture</a></li><li><a class="tocitem" href="../../../../overview/networking/">Networking</a></li><li><a class="tocitem" href="../../../../overview/hardware/">Hardware Support</a></li><li><a class="tocitem" href="../../../../overview/os/">Operating Systems</a></li><li><a class="tocitem" href="../../../../overview/kubernetes/">Kubernetes Integration</a></li><li><a class="tocitem" href="../../../../overview/storage/">Storage</a></li><li><a class="tocitem" href="../../../../overview/comparison/">Comparison</a></li></ul></li><li><a class="tocitem" href="../../../../quickstart/">Quickstart</a></li><li><span class="tocitem">Installation &amp; Administration</span><ul><li><a class="tocitem" href="../../../../installation/deployment/">Installation</a></li><li><a class="tocitem" href="../../../../installation/monitoring/">Monitoring</a></li><li><a class="tocitem" href="../../../../installation/troubleshoot/">Troubleshoot</a></li></ul></li><li><span class="tocitem">User Guides</span><ul><li><a class="tocitem" href="../../../../external/mini-lab/README/">mini-lab</a></li><li><a class="tocitem" href="../../../../external/metalctl/README/">metalctl</a></li><li><a class="tocitem" href="../../../../external/csi-driver-lvm/README/">csi-driver-lvm</a></li><li><a class="tocitem" href="../../../../external/firewall-controller/README/">firewall-controller</a></li></ul></li><li><a class="tocitem" href="../../../../apidocs/apidocs/">API Documentation</a></li><li><span class="tocitem">Development</span><ul><li><a class="tocitem" href="../../../client_libraries/">Client Libraries</a></li><li><a class="tocitem" href="../../../roadmap/">Roadmap</a></li><li><a class="tocitem" href="../../">Enhancement Proposals</a></li><li><a class="tocitem" href="../../../contributing/">Contributing</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>SONiC Support</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>SONiC Support</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/metal-stack/docs/blob/master/docs/src/development/proposals/MEP10/README.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="SONiC-Support"><a class="docs-heading-anchor" href="#SONiC-Support">SONiC Support</a><a id="SONiC-Support-1"></a><a class="docs-heading-anchor-permalink" href="#SONiC-Support" title="Permalink"></a></h1><p>As writing this proposal, metal-stack only supports Cumulus on Broadcom ASICs. Unfortunately, after the acquisition of  Cumulus Networks by Nvidia, Broadcom decided to cut its relationship with Cumulus, and therefore Cumulus 4.2 is the last version that supports Broadcom ASICs. Since trashing the existing hardware is not a solution, adding support for a  different network operating system is necessary.</p><p>One of the remaining big players is <a href="https://sonic-net.github.io/SONiC/">SONiC</a>, which Microsoft created to scale the  network of Azure. It&#39;s an open-source project and is now part of the <a href="https://www.linuxfoundation.org/press-release/software-for-open-networking-in-the-cloud-sonic-moves-to-the-linux-foundation/">Linux Foundation</a>.</p><p>For a general introduction to SONiC, please follow the (https://github.com/sonic-net/SONiC/wiki/Architecture) official  documentation.</p><h2 id="ConfigDB"><a class="docs-heading-anchor" href="#ConfigDB">ConfigDB</a><a id="ConfigDB-1"></a><a class="docs-heading-anchor-permalink" href="#ConfigDB" title="Permalink"></a></h2><p>On a cold start, the content of <code>/etc/sonic/config_db.json</code> will be loaded into the Redis database <code>CONFIG_DB</code>, and both contain the switch&#39;s configuration except the BGP unnumbered configuration, which still has to be configured directly by the frr configuration files. The SONiC community is working to remove this exception, but no release date is known.</p><h2 id="BGP-Configuration"><a class="docs-heading-anchor" href="#BGP-Configuration">BGP Configuration</a><a id="BGP-Configuration-1"></a><a class="docs-heading-anchor-permalink" href="#BGP-Configuration" title="Permalink"></a></h2><p>Frr runs inside a container, and a shell script configured it on the container startup. For BGP unnumbered, we must set the configuration variable <code>docker_routing_config_mode</code> to <code>split</code> to prevent SONiC from overwriting our configuration  files created by <code>metal-core</code>. But by using the split mode, the integrated configuration mode of frr is deactivated, and we have to write our BGP configuration to the daemon-specific files <code>bgp.conf</code>, <code>staticd.conf</code>, and <code>zebra.conf</code> instead to <code>frr.conf</code>.</p><pre><code class="language-shell hljs">elif [ &quot;$CONFIG_TYPE&quot; == &quot;split&quot; ]; then
    echo &quot;no service integrated-vtysh-config&quot; &gt; /etc/frr/vtysh.conf
    rm -f /etc/frr/frr.conf</code></pre><p>Reference: https://github.com/Azure/sonic-buildimage/blob/202205/dockers/docker-fpm-frr/docker_init.sh#L69</p><p>Adding support for the integrated configuration mode, we must at least adjust the startup shell script and the supervisor configuration:</p><pre><code class="nohighlight hljs">{% if DEVICE_METADATA.localhost.docker_routing_config_mode is defined and DEVICE_METADATA.localhost.docker_routing_config_mode == &quot;unified&quot; %}
[program:vtysh_b]
command=/usr/bin/vtysh -b</code></pre><p>Reference: https://github.com/Azure/sonic-buildimage/blob/202|205/dockers/docker-fpm-frr/frr/supervisord/supervisord.conf.j2#L157</p><h2 id="Non-BGP-Configuration"><a class="docs-heading-anchor" href="#Non-BGP-Configuration">Non-BGP Configuration</a><a id="Non-BGP-Configuration-1"></a><a class="docs-heading-anchor-permalink" href="#Non-BGP-Configuration" title="Permalink"></a></h2><p>For the Non-BGP configuration we have to write it into the Redis database directly or via one of the following interfaces:</p><ul><li><code>config replace &lt;file&gt;</code></li><li>the Mgmt Framework</li><li>the SONiC restapi</li></ul><p>Directly writing into the Redis database isn&#39;t a stable interface, and we must determine the create, delete, and update  operations on our own. The last point is also valid for the Mgmt Framework and the SONiC restapi. Furthermore, the  Mgmt Framework doesn&#39;t start anymore for several months, and a <a href="https://github.com/Azure/sonic-buildimage/pull/10893">potential fix</a>  is still not merged. And the SONiC restapi isn&#39;t enabled by default, and we must build and maintain our own SONiC images.</p><p>Using <code>config replace</code> would reduce the complexity in the <code>metal-core</code> codebase because we don&#39;t have to determine the  actual changes between the running and the desired configuration. The approach&#39;s drawbacks are using a version of SONiC that contains the PR <a href="https://github.com/Azure/sonic-buildimage/pull/7294">Yang support for VXLAN</a>, and we must provide  the whole new startup configuration to prevent unwanted deconfiguration.</p></article><nav class="docs-footer"><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.10 on <span class="colophon-date" title="Monday 18 July 2022 14:30">Monday 18 July 2022</span>. Using Julia version 1.6.1.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
