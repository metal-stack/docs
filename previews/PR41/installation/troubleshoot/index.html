<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Troubleshoot · metal-stack</title><link rel="canonical" href="https://docs.metal-stack.io/installation/troubleshoot/"/><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script><link href="../../assets/favicon.ico" rel="icon" type="image/x-icon"/><link href="../../assets/youtube.css" rel="stylesheet" type="text/css"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img src="../../assets/logo.svg" alt="metal-stack logo"/></a><div class="docs-package-name"><span class="docs-autofit">metal-stack</span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">Introduction</a></li><li><span class="tocitem">Overview</span><ul><li><a class="tocitem" href="../../overview/architecture/">Architecture</a></li><li><a class="tocitem" href="../../overview/networking/">Networking</a></li><li><a class="tocitem" href="../../overview/hardware/">Hardware Support</a></li><li><a class="tocitem" href="../../overview/os/">Operating Systems</a></li><li><a class="tocitem" href="../../overview/kubernetes/">Kubernetes Integration</a></li><li><a class="tocitem" href="../../overview/storage/">Storage</a></li></ul></li><li><a class="tocitem" href="../../quickstart/">Quickstart</a></li><li><span class="tocitem">Installation &amp; Administration</span><ul><li><a class="tocitem" href="../deployment/">Installation</a></li><li><a class="tocitem" href="../monitoring/">Monitoring</a></li><li class="is-active"><a class="tocitem" href>Troubleshoot</a><ul class="internal"><li><a class="tocitem" href="#Deployment"><span>Deployment</span></a></li></ul></li></ul></li><li><span class="tocitem">User Guides</span><ul><li><a class="tocitem" href="../../external/mini-lab/README/">mini-lab</a></li><li><a class="tocitem" href="../../external/metalctl/README/">metalctl</a></li><li><a class="tocitem" href="../../external/csi-driver-lvm/README/">csi-driver-lvm</a></li><li><a class="tocitem" href="../../external/firewall-controller/README/">firewall-controller</a></li></ul></li><li><a class="tocitem" href="../../apidocs/apidocs/">API Documentation</a></li><li><span class="tocitem">Development</span><ul><li><a class="tocitem" href="../../development/client_libraries/">Client Libraries</a></li><li><a class="tocitem" href="../../development/roadmap/">Roadmap</a></li><li><a class="tocitem" href="../../development/proposals/">Enhancement Proposals</a></li><li><a class="tocitem" href="../../development/contributing/">Contributing</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Installation &amp; Administration</a></li><li class="is-active"><a href>Troubleshoot</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Troubleshoot</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/metal-stack/docs/blob/master/docs/src/installation/troubleshoot.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Troubleshoot"><a class="docs-heading-anchor" href="#Troubleshoot">Troubleshoot</a><a id="Troubleshoot-1"></a><a class="docs-heading-anchor-permalink" href="#Troubleshoot" title="Permalink"></a></h1><p>This document summarizes help when something goes wrong and provides advice on debugging the metal-stack in certain situations.</p><p>Of course, it is also advisable to check out the issues on the Github projects for help.</p><p>If you still can&#39;t find a solution to your problem, please reach out to us and our community. We have a public Slack Channel to discuss problems, but you can also reach us via mail. Check out <a href="https://metal-stack.io">metal-stack.io</a> for contact information.</p><ul><li><a href="#Troubleshoot">Troubleshoot</a></li><ul><li><a href="#Deployment">Deployment</a></li><ul><li><a href="#Ansible-fails-when-the-metal-control-plane-helm-chart-gets-applied">Ansible fails when the metal control plane helm chart gets applied</a></li><li><a href="#In-the-mini-lab-I-can&#39;t-SSH-into-the-leaf-switches-anymore">In the mini-lab I can&#39;t SSH into the leaf switches anymore</a></li><li><a href="#In-the-mini-lab-the-control-plane-deployment-fails-because-my-system-can&#39;t-resolve-api.0.0.0.0.xip.io">In the mini-lab the control-plane deployment fails because my system can&#39;t resolve api.0.0.0.0.xip.io</a></li><ul><li><a href="#FritzBox">FritzBox</a></li></ul></ul></ul></ul><h2 id="Deployment"><a class="docs-heading-anchor" href="#Deployment">Deployment</a><a id="Deployment-1"></a><a class="docs-heading-anchor-permalink" href="#Deployment" title="Permalink"></a></h2><h3 id="Ansible-fails-when-the-metal-control-plane-helm-chart-gets-applied"><a class="docs-heading-anchor" href="#Ansible-fails-when-the-metal-control-plane-helm-chart-gets-applied">Ansible fails when the metal control plane helm chart gets applied</a><a id="Ansible-fails-when-the-metal-control-plane-helm-chart-gets-applied-1"></a><a class="docs-heading-anchor-permalink" href="#Ansible-fails-when-the-metal-control-plane-helm-chart-gets-applied" title="Permalink"></a></h3><p>There can be many reasons for this. Since you are deploying the metal control plane into a Kubernetes cluster, the first step should be to install <a href="https://kubernetes.io/docs/tasks/tools/install-kubectl/">kubectl</a> and check the pods in your cluster. Depending on the metal-stack version and Kubernetes cluster, your control-plane should look something like this after the deployment (this is in a Kind cluster):</p><pre><code class="language-bash">kubectl get pod -A
NAMESPACE             NAME                                         READY   STATUS      RESTARTS   AGE
ingress-nginx         nginx-ingress-controller-56966f7dc7-khfp9    1/1     Running     0          2m34s
kube-system           coredns-66bff467f8-grn7q                     1/1     Running     0          2m34s
kube-system           coredns-66bff467f8-n7n77                     1/1     Running     0          2m34s
kube-system           etcd-kind-control-plane                      1/1     Running     0          2m42s
kube-system           kindnet-4dv7m                                1/1     Running     0          2m34s
kube-system           kube-apiserver-kind-control-plane            1/1     Running     0          2m42s
kube-system           kube-controller-manager-kind-control-plane   1/1     Running     0          2m42s
kube-system           kube-proxy-jz7kp                             1/1     Running     0          2m34s
kube-system           kube-scheduler-kind-control-plane            1/1     Running     0          2m42s
local-path-storage    local-path-provisioner-bd4bb6b75-cwfb7       1/1     Running     0          2m34s
metal-control-plane   ipam-db-0                                    2/2     Running     0          2m31s
metal-control-plane   masterdata-api-6dd4b54db5-rwk45              1/1     Running     0          33s
metal-control-plane   masterdata-db-0                              2/2     Running     0          2m29s
metal-control-plane   metal-api-998cb46c4-jj2tt                    1/1     Running     0          33s
metal-control-plane   metal-api-initdb-r9sc6                       0/1     Completed   0          2m24s
metal-control-plane   metal-api-liveliness-1590479940-brhc7        0/1     Completed   0          6s
metal-control-plane   metal-console-7955cbb7d7-p6hxp               1/1     Running     0          33s
metal-control-plane   metal-db-0                                   2/2     Running     0          2m34s
metal-control-plane   nsq-lookupd-5b4ccbfb64-n6prg                 1/1     Running     0          2m34s
metal-control-plane   nsqd-6cd87f69c4-vtn9k                        2/2     Running     0          2m33s</code></pre><p>If there are any failing pods, investigate those and look into container logs. This information should point you to the place where the deployment goes wrong.</p><div class="admonition is-info"><header class="admonition-header">Info</header><div class="admonition-body"><p>Sometimes, you see a helm errors like &quot;no deployed releases&quot; or something like this. When a helm chart fails after the first deployment it could be that you have a chart installation still pending. Also, the control plane helm chart uses pre- and post-hooks, which creates <a href="https://kubernetes.io/docs/concepts/workloads/controllers/job/">jobs</a> that helm expects to be completed before attempting another deployment. Delete the helm chart (use Helm 3) with <code>helm delete -n metal-control-plane metal-control-plane</code> and delete the jobs in the <code>metal-control-plane</code> namespace before retrying the deployment.</p></div></div><h3 id="In-the-mini-lab-I-can&#39;t-SSH-into-the-leaf-switches-anymore"><a class="docs-heading-anchor" href="#In-the-mini-lab-I-can&#39;t-SSH-into-the-leaf-switches-anymore">In the mini-lab I can&#39;t SSH into the leaf switches anymore</a><a id="In-the-mini-lab-I-can&#39;t-SSH-into-the-leaf-switches-anymore-1"></a><a class="docs-heading-anchor-permalink" href="#In-the-mini-lab-I-can&#39;t-SSH-into-the-leaf-switches-anymore" title="Permalink"></a></h3><p>The <code>vagrant ssh leaf01</code> command returns an error like this:</p><pre><code class="language-none">The provider for this Vagrant-managed machine is reporting that it
is not yet ready for SSH. Depending on your provider this can carry
different meanings. Make sure your machine is created and running and
try again. Additionally, check the output of `vagrant status` to verify
that the machine is in the state that you expect. If you continue to
get this error message, please view the documentation for the provider
you&#39;re using.</code></pre><p>This is actually expected behavior. As soon as the metal-core reconfigures the switch interfaces, the <code>eth0</code> interface will be reconfigured from DHCP to static. This causes Vagrant not to be able to figure out the IP address of the VM through dnsmasq anymore (which is how Vagrant gets to know the IP address of the VM for libvirt). The IP address of the switch is still the same though. You can still access the VM using SSH with the vagrant user.</p><p>There are a couple of ways to get to know the IP address of the switch:</p><ul><li>You can look it up in the switch interface configuration using the VM console</li><li>It is cached by the Ansible Vagrant dynamic inventory</li></ul><p>The following way describes how to access <code>leaf01</code> using the information from the dynamic inventory:</p><pre><code class="language-bash">$ python3 -c &#39;import pickle; print(pickle.load(open(&quot;.ansible_vagrant_cache&quot;, &quot;rb&quot;))[&quot;meta_vars&quot;][&quot;leaf01&quot;][&quot;ansible_host&quot;])&#39;
192.168.121.25
$ ssh vagrant@192.168.121.25 # password is vagrant</code></pre><h3 id="In-the-mini-lab-the-control-plane-deployment-fails-because-my-system-can&#39;t-resolve-api.0.0.0.0.xip.io"><a class="docs-heading-anchor" href="#In-the-mini-lab-the-control-plane-deployment-fails-because-my-system-can&#39;t-resolve-api.0.0.0.0.xip.io">In the mini-lab the control-plane deployment fails because my system can&#39;t resolve api.0.0.0.0.xip.io</a><a id="In-the-mini-lab-the-control-plane-deployment-fails-because-my-system-can&#39;t-resolve-api.0.0.0.0.xip.io-1"></a><a class="docs-heading-anchor-permalink" href="#In-the-mini-lab-the-control-plane-deployment-fails-because-my-system-can&#39;t-resolve-api.0.0.0.0.xip.io" title="Permalink"></a></h3><p>The control-plane deployment returns an error like this:</p><pre><code class="language-none">deploy-control-plane | fatal: [localhost]: FAILED! =&gt; changed=false
deploy-control-plane |   attempts: 60
deploy-control-plane |   content: &#39;&#39;
deploy-control-plane |   elapsed: 0                                                                   
deploy-control-plane |   msg: &#39;Status code was -1 and not [200]: Request failed: &lt;urlopen error [Errno -5] No address associated with hostname&gt;&#39;
deploy-control-plane |   redirected: false
deploy-control-plane |   status: -1                                                                                                                                       
deploy-control-plane |   url: http://api.0.0.0.0.xip.io:8080/metal/v1/health
deploy-control-plane |                                                                                                            
deploy-control-plane | PLAY RECAP *********************************************************************                                                                          
deploy-control-plane | localhost                  : ok=29   changed=4    unreachable=0    failed=1    skipped=7    rescued=0    ignored=0                      
deploy-control-plane |                                                                                                                                                                                             
deploy-control-plane exited with code 2</code></pre><p>Some home routers have a security feature that prevents DNS Servers to resolve anything in the router&#39;s local IP range (DNS-Rebind-Protection).</p><p>You need to add an exception for <code>xip.io</code> in your router configuration.</p><h4 id="FritzBox"><a class="docs-heading-anchor" href="#FritzBox">FritzBox</a><a id="FritzBox-1"></a><a class="docs-heading-anchor-permalink" href="#FritzBox" title="Permalink"></a></h4><p><code>Home Network -&gt; Network -&gt; Network Settings -&gt; Additional Settings -&gt; DNS Rebind Protection -&gt; Host name exceptions -&gt; xip.io</code></p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../monitoring/">« Monitoring</a><a class="docs-footer-nextpage" href="../../external/mini-lab/README/">mini-lab »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Thursday 4 February 2021 12:45">Thursday 4 February 2021</span>. Using Julia version 1.4.2.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
