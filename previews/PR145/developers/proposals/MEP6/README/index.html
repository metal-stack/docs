<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>DMZ Networks · metal-stack</title><meta name="title" content="DMZ Networks · metal-stack"/><meta property="og:title" content="DMZ Networks · metal-stack"/><meta property="twitter:title" content="DMZ Networks · metal-stack"/><meta name="description" content="Documentation for metal-stack."/><meta property="og:description" content="Documentation for metal-stack."/><meta property="twitter:description" content="Documentation for metal-stack."/><meta property="og:url" content="https://docs.metal-stack.io/developers/proposals/MEP6/README/"/><meta property="twitter:url" content="https://docs.metal-stack.io/developers/proposals/MEP6/README/"/><link rel="canonical" href="https://docs.metal-stack.io/developers/proposals/MEP6/README/"/><script data-outdated-warner src="../../../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../../../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../../../assets/documenter.js"></script><script src="../../../../search_index.js"></script><script src="../../../../siteinfo.js"></script><script src="../../../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../../../assets/themeswap.js"></script><link href="../../../../assets/favicon.ico" rel="icon" type="image/x-icon"/><link href="../../../../assets/youtube.css" rel="stylesheet" type="text/css"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../../../"><img src="../../../../assets/logo.svg" alt="metal-stack logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../../../">metal-stack</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../../../">Home</a></li><li><a class="tocitem" href="../../../../getting-started/">Getting Started</a></li><li><span class="tocitem">Concepts</span><ul><li><a class="tocitem" href="../../../../concepts/why-metal-stack/">Why metal-stack</a></li><li><a class="tocitem" href="../../../../concepts/why-bare-metal/">Why Bare Metal</a></li><li><a class="tocitem" href="../../../../concepts/architecture/">Architecture</a></li><li><input class="collapse-toggle" id="menuitem-3-4" type="checkbox"/><label class="tocitem" for="menuitem-3-4"><span class="docs-label">Network</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../../concepts/network/theory/">Theory</a></li><li><a class="tocitem" href="../../../../concepts/network/firewalls/">Firewalls</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-5" type="checkbox"/><label class="tocitem" for="menuitem-3-5"><span class="docs-label">Kubernetes</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../../concepts/kubernetes/cloud-controller-manager/">Cloud Controller Manager</a></li><li><a class="tocitem" href="../../../../concepts/kubernetes/firewall-controller-manager/">Firewall Controller Manager</a></li><li><a class="tocitem" href="../../../../concepts/kubernetes/gardener/">Gardener</a></li><li><a class="tocitem" href="../../../../concepts/kubernetes/isolated-clusters/">Isolated Cluster</a></li><li><a class="tocitem" href="../../../../concepts/kubernetes/gpu-workers/">GPU Workers</a></li><li><a class="tocitem" href="../../../../concepts/kubernetes/storage/">Storage</a></li></ul></li></ul></li><li><span class="tocitem">For Operators</span><ul><li><a class="tocitem" href="../../../../operators/hardware/">Supported Hardware</a></li><li><a class="tocitem" href="../../../../operators/operating-systems/">Operating Systems</a></li><li><a class="tocitem" href="../../../../operators/deployment-guide/">Deployment Guide</a></li><li><a class="tocitem" href="../../../../operators/upgrades/">Upgrades</a></li><li><a class="tocitem" href="../../../../operators/troubleshoot/">Troubleshoot</a></li></ul></li><li><span class="tocitem">For Users</span><ul><li><a class="tocitem" href="../../../../users/client-libraries/">Client Libraries</a></li></ul></li><li><span class="tocitem">For Developers</span><ul><li><a class="tocitem" href="../../">Enhancement Proposals</a></li><li><a class="tocitem" href="../../../planning-meetings/">Planning Meetings</a></li><li><a class="tocitem" href="../../../contribution-guideline/">Contribution Guideline</a></li><li><a class="tocitem" href="../../../release-flow/">Release Flow</a></li><li><a class="tocitem" href="../../../community/">Community</a></li></ul></li><li><span class="tocitem">References</span><ul><li><a class="tocitem" href="../../../../references/apidocs/">API</a></li><li><input class="collapse-toggle" id="menuitem-7-2" type="checkbox"/><label class="tocitem" for="menuitem-7-2"><span class="docs-label">Components</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../../references/external/mini-lab/README/">mini-lab</a></li><li><a class="tocitem" href="../../../../references/external/metalctl/README/">metalctl</a></li><li><a class="tocitem" href="../../../../references/external/csi-driver-lvm/README/">csi-driver-lvm</a></li><li><a class="tocitem" href="../../../../references/external/firewall-controller/README/">firewall-controller</a></li><li><a class="tocitem" href="../../../../references/external/tailscale/README/">tailscale</a></li></ul></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>DMZ Networks</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>DMZ Networks</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/metal-stack/docs.git" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="github.com/metal-stack/docs.git" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="DMZ-Networks"><a class="docs-heading-anchor" href="#DMZ-Networks">DMZ Networks</a><a id="DMZ-Networks-1"></a><a class="docs-heading-anchor-permalink" href="#DMZ-Networks" title="Permalink"></a></h1><h2 id="Reasoning"><a class="docs-heading-anchor" href="#Reasoning">Reasoning</a><a id="Reasoning-1"></a><a class="docs-heading-anchor-permalink" href="#Reasoning" title="Permalink"></a></h2><p>To fulfill higher levels of security measures the standard metal-stack approach with a single firewall in front of a set of machines might be insufficient. There are cases where two physically distinct firewalls in front of application workload are mandatory. In traditional network terms this is known as DMZ approach.</p><p>For Kubernetes workloads it makes sense to use the front cluster for ingress, WAF purposes and as outgoing proxy. The clusters may be used for application workload.</p><h2 id="DMZ-network"><a class="docs-heading-anchor" href="#DMZ-network">DMZ network</a><a id="DMZ-network-1"></a><a class="docs-heading-anchor-permalink" href="#DMZ-network" title="Permalink"></a></h2><ul><li>Use a separate DMZ network prefix for every tenant</li><li>This is used as intermediate network btw. private networks of a tenant and the internet</li><li>For every partition a distinct DMZ firewall/cluster is needed for a tenant</li><li>For Gardener orchestrated Kubernetes clusters this network must be a publicly reachable internet prefix because shoot clusters need a vpn service that is used for instrumentation from the seed cluster - this will be a requirement as long as the inverse vpn tunnel feature Konnectivity is not available to us.</li></ul><h2 id="Approach-1:-DMZ-with-publicly-reachable-internet-prefix"><a class="docs-heading-anchor" href="#Approach-1:-DMZ-with-publicly-reachable-internet-prefix">Approach 1: DMZ with publicly reachable internet prefix</a><a id="Approach-1:-DMZ-with-publicly-reachable-internet-prefix-1"></a><a class="docs-heading-anchor-permalink" href="#Approach-1:-DMZ-with-publicly-reachable-internet-prefix" title="Permalink"></a></h2><p><img src="../dmz-internet_public.svg" alt="DMZ Internet"/></p><p>A DMZ network with publicly reachable internet prefix will look like this in the metal-api:</p><pre><code class="language-yaml hljs">---
description: DMZ-Network
destinationprefixes:
- 0.0.0.0/0
id: dmz
labels:
  network.metal-stack.io/default-external: &quot;&quot;
name: DMZ-Network
parentnetworkid: null
partitionid: &quot;&quot;
prefixes:
- 212.90.30.128/25
privatesuper: false
projectid: &quot;&quot;
vrf: 104007
vrfshared: false
nat: true
shared: false
underlay: false</code></pre><h3 id="DMZ-firewall"><a class="docs-heading-anchor" href="#DMZ-firewall">DMZ firewall</a><a id="DMZ-firewall-1"></a><a class="docs-heading-anchor-permalink" href="#DMZ-firewall" title="Permalink"></a></h3><p>The firewall of the DMZ will intersect its private network for attached machines, the DMZ network and the public internet.</p><ul><li>The private network of the project needs to import<ul><li>the default route from the internet network</li><li>the DMZ network</li></ul></li><li>The internet network must import the DMZ network</li><li>The DMZ network provides the default route for tenant&#39;s clusters in a partition. It imports the default route from the internet network</li></ul><h3 id="Application-Firewall"><a class="docs-heading-anchor" href="#Application-Firewall">Application Firewall</a><a id="Application-Firewall-1"></a><a class="docs-heading-anchor-permalink" href="#Application-Firewall" title="Permalink"></a></h3><p>The firewall of application workloads intersects its private network for attached machines and the DMZ network.</p><p>This is currently supported by the metal-networker and needs no further changes!</p><h2 id="Approach-2:-DMZ-with-private-IPs"><a class="docs-heading-anchor" href="#Approach-2:-DMZ-with-private-IPs">Approach 2: DMZ with private IPs</a><a id="Approach-2:-DMZ-with-private-IPs-1"></a><a class="docs-heading-anchor-permalink" href="#Approach-2:-DMZ-with-private-IPs" title="Permalink"></a></h2><p><img src="../dmz-internet_private.svg" alt="DMZ Internet"/></p><p>A DMZ network with private IPs will look like this in the metal-api:</p><pre><code class="language-yaml hljs">---
description: DMZ-Network
destinationprefixes:
- 0.0.0.0/0
id: dmz
labels:
  network.metal-stack.io/default-external: &quot;&quot;
name: DMZ-Network
parentnetworkid: tenant-super-network-fra-equ01
partitionid: fra-equ01
prefixes:
- 10.90.30.128/25
privatesuper: false
projectid: &quot;&quot;
vrf: 4711
vrfshared: false
nat: true
shared: true # it&#39;s usable from multiple projects
underlay: false</code></pre><h3 id="DMZ-firewall-2"><a class="docs-heading-anchor" href="#DMZ-firewall-2">DMZ firewall</a><a class="docs-heading-anchor-permalink" href="#DMZ-firewall-2" title="Permalink"></a></h3><p>The firewall of the DMZ will intersect its private network for attached machines, the DMZ network and the public internet.</p><ul><li>The private network of the project needs to import<ul><li>the default route from the internet network</li><li>the DMZ network</li></ul></li><li>The internet network must import the DMZ network (only locally, no-export)</li><li>The DMZ network provides the default route for tenant&#39;s clusters in a partition. It imports the default route from the internet network</li></ul><h3 id="Application-Firewall-2"><a class="docs-heading-anchor" href="#Application-Firewall-2">Application Firewall</a><a class="docs-heading-anchor-permalink" href="#Application-Firewall-2" title="Permalink"></a></h3><p>The firewall of application workloads intersects its private network for attached machines and the DMZ network. </p><h2 id="Code-Changes-/-Implications"><a class="docs-heading-anchor" href="#Code-Changes-/-Implications">Code Changes / Implications</a><a id="Code-Changes-/-Implications-1"></a><a class="docs-heading-anchor-permalink" href="#Code-Changes-/-Implications" title="Permalink"></a></h2><ul><li><code>metal-networker</code> and <code>metal-ccm</code> assume that there is only one network providing the default-route</li><li><code>metal-networker</code> needs to<ul><li>import the default route from the internet network to the dmz network (DMZ Firewall)</li><li>import the DMZ network to the internet network and adjusting NAT rules (DMZ Firewall)</li><li>import destination prefixes of the DMZ network to the private primary network (DMZ Firewall, Application Firewall)</li><li>import DMZ-IPs of the private primary network to the DMZ network (DMZ Firewall, Application Firewall)</li></ul></li><li><code>metal-api</code>: destination prefixes of private networks need to be configurable (<code>allocateNetwork</code>)</li><li><code>gardener-extension-provider-metal</code>: needs to be able to delete DMZ clusters (but skip the network deletion part)</li><li>the application firewall is not publicly reachable - for debugging purposes a hop over the DMZ firewall is needed</li></ul><h2 id="Decision"><a class="docs-heading-anchor" href="#Decision">Decision</a><a id="Decision-1"></a><a class="docs-heading-anchor-permalink" href="#Decision" title="Permalink"></a></h2><p>We decided to follow the second approach with private DMZ networks.</p></article><nav class="docs-footer"><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.7.0 on <span class="colophon-date" title="Wednesday 18 June 2025 06:33">Wednesday 18 June 2025</span>. Using Julia version 1.9.4.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
