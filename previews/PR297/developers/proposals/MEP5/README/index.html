<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Shared Networks · metal-stack</title><meta name="title" content="Shared Networks · metal-stack"/><meta property="og:title" content="Shared Networks · metal-stack"/><meta property="twitter:title" content="Shared Networks · metal-stack"/><meta name="description" content="Documentation for metal-stack."/><meta property="og:description" content="Documentation for metal-stack."/><meta property="twitter:description" content="Documentation for metal-stack."/><meta property="og:url" content="https://docs.metal-stack.io/developers/proposals/MEP5/README/"/><meta property="twitter:url" content="https://docs.metal-stack.io/developers/proposals/MEP5/README/"/><link rel="canonical" href="https://docs.metal-stack.io/developers/proposals/MEP5/README/"/><script data-outdated-warner src="../../../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../../../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../../../assets/documenter.js"></script><script src="../../../../search_index.js"></script><script src="../../../../siteinfo.js"></script><script src="../../../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../../../assets/themeswap.js"></script><link href="../../../../assets/favicon.ico" rel="icon" type="image/x-icon"/><link href="../../../../assets/youtube.css" rel="stylesheet" type="text/css"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../../../"><img src="../../../../assets/logo.svg" alt="metal-stack logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../../../">metal-stack</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../../../">Home</a></li><li><a class="tocitem" href="../../../../getting-started/">Getting Started</a></li><li><span class="tocitem">Concepts</span><ul><li><a class="tocitem" href="../../../../concepts/why-metal-stack/">Why metal-stack</a></li><li><a class="tocitem" href="../../../../concepts/why-bare-metal/">Why Bare Metal</a></li><li><a class="tocitem" href="../../../../concepts/architecture/">Architecture</a></li><li><input class="collapse-toggle" id="menuitem-3-4" type="checkbox"/><label class="tocitem" for="menuitem-3-4"><span class="docs-label">Network</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../../concepts/network/theory/">Theory</a></li><li><a class="tocitem" href="../../../../concepts/network/firewalls/">Firewalls</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-3-5" type="checkbox"/><label class="tocitem" for="menuitem-3-5"><span class="docs-label">Kubernetes</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../../concepts/kubernetes/cloud-controller-manager/">Cloud Controller Manager</a></li><li><a class="tocitem" href="../../../../concepts/kubernetes/firewall-controller-manager/">Firewall Controller Manager</a></li><li><a class="tocitem" href="../../../../concepts/kubernetes/gardener/">Gardener</a></li><li><a class="tocitem" href="../../../../concepts/kubernetes/isolated-clusters/">Isolated Cluster</a></li><li><a class="tocitem" href="../../../../concepts/kubernetes/gpu-workers/">GPU Workers</a></li><li><a class="tocitem" href="../../../../concepts/kubernetes/storage/">Storage</a></li></ul></li></ul></li><li><span class="tocitem">For Operators</span><ul><li><a class="tocitem" href="../../../../operators/hardware/">Supported Hardware</a></li><li><a class="tocitem" href="../../../../operators/operating-systems/">Operating Systems</a></li><li><a class="tocitem" href="../../../../operators/deployment-guide/">Deployment Guide</a></li><li><a class="tocitem" href="../../../../operators/maintenance/">Maintenance</a></li><li><a class="tocitem" href="../../../../operators/troubleshoot/">Troubleshoot</a></li></ul></li><li><span class="tocitem">For Users</span><ul><li><a class="tocitem" href="../../../../users/client-libraries/">Client Libraries</a></li></ul></li><li><span class="tocitem">For Developers</span><ul><li><a class="tocitem" href="../../">Enhancement Proposals</a></li><li><a class="tocitem" href="../../../planning-meetings/">Planning Meetings</a></li><li><a class="tocitem" href="../../../contribution-guideline/">Contribution Guideline</a></li><li><a class="tocitem" href="../../../release-flow/">Release Flow</a></li><li><a class="tocitem" href="../../../community/">Community</a></li></ul></li><li><span class="tocitem">References</span><ul><li><a class="tocitem" href="../../../../references/apidocs/">API</a></li><li><input class="collapse-toggle" id="menuitem-7-2" type="checkbox"/><label class="tocitem" for="menuitem-7-2"><span class="docs-label">Components</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../../../references/external/mini-lab/README/">mini-lab</a></li><li><a class="tocitem" href="../../../../references/external/metalctl/README/">metalctl</a></li><li><a class="tocitem" href="../../../../references/external/csi-driver-lvm/README/">csi-driver-lvm</a></li><li><a class="tocitem" href="../../../../references/external/firewall-controller/README/">firewall-controller</a></li><li><a class="tocitem" href="../../../../references/external/tailscale/README/">tailscale</a></li></ul></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Shared Networks</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Shared Networks</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/metal-stack/docs.git" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="github.com/metal-stack/docs.git" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Shared-Networks"><a class="docs-heading-anchor" href="#Shared-Networks">Shared Networks</a><a id="Shared-Networks-1"></a><a class="docs-heading-anchor-permalink" href="#Shared-Networks" title="Permalink"></a></h1><h2 id="Why-are-shared-networks-needed"><a class="docs-heading-anchor" href="#Why-are-shared-networks-needed">Why are shared networks needed</a><a id="Why-are-shared-networks-needed-1"></a><a class="docs-heading-anchor-permalink" href="#Why-are-shared-networks-needed" title="Permalink"></a></h2><p>For special purpose machines that serve shared services with performance critical workloads to all machines of a partition (like persistent storage) it would be good to have kind of a &quot;shared network&quot; that is easily accessible. They do not necessarily need another firewall. This would avoid having two firewalls in the datapath between a machine in a private network and the machines of a shared service.</p><h2 id="Constraints-that-need-to-hold"><a class="docs-heading-anchor" href="#Constraints-that-need-to-hold">Constraints that need to hold</a><a id="Constraints-that-need-to-hold-1"></a><a class="docs-heading-anchor-permalink" href="#Constraints-that-need-to-hold" title="Permalink"></a></h2><ul><li>a shared network is usable from all machines that have a firewall in front, that uses it</li><li>a shared network is only usable within a single partition (currently we are constrained in bandwidth and have no routing of 10.0.0.0/8 addresses btw. partitions and failure domain should be the partition but this constraint might get lifted in the future)</li><li>networks may be marked as shared after network allocation (but there should be no way back from shared to unshared)</li><li>neither machines nor firewalls may have multiple private, unshared networks configured</li><li>machines must have a single primary network configured<ul><li>this might be a shared network</li><li>OR a plain, unshared private network</li></ul></li><li>firewalls may participate in multiple shared networks</li><li>machines can be allocated with a primary network using auto IP allocation or with <code>noauto</code> and a specific IP</li></ul><h2 id="Should-shared-networks-be-private"><a class="docs-heading-anchor" href="#Should-shared-networks-be-private">Should shared networks be private</a><a id="Should-shared-networks-be-private-1"></a><a class="docs-heading-anchor-permalink" href="#Should-shared-networks-be-private" title="Permalink"></a></h2><p><strong>Alternative 1:</strong> If we implemented shared networks by extending functions around plain, private networks we would not have to manage another CIDR (mini point) and it would be possible to create a k8s cluster with a private network, mark the network as <code>shared</code> and produce shared services from this k8s cluster.</p><p><strong>Alternative 2:</strong> If shared networks are implemented as first class networks we could customize the VRF and also accomplish an other goal of our roadmap: being able to create machines directly in an external network.</p><p>Together with @majst01 and @Gerrit91 we decided to continue to implement  <strong>Alternative 1</strong>.</p><h2 id="Firewalls-accessing-a-shared-network"><a class="docs-heading-anchor" href="#Firewalls-accessing-a-shared-network">Firewalls accessing a shared network</a><a id="Firewalls-accessing-a-shared-network-1"></a><a class="docs-heading-anchor-permalink" href="#Firewalls-accessing-a-shared-network" title="Permalink"></a></h2><p>Firewalls that access shared networks need to:</p><ul><li>hide the private network behind an ip address of the shared network if the shared network was configured with <code>nat=true</code>.</li><li>import the prefixes of the shared VRF to the private VRF and import the prefixes of the private VRF to the shared VRF so that the communication between the two is working in both directions. As long as no <code>nat=true</code> was set on the shared VRF, the original machine ips are visible in both communication directions.</li></ul><h2 id="Setup-with-shared-networks-and-single-consumer"><a class="docs-heading-anchor" href="#Setup-with-shared-networks-and-single-consumer">Setup with shared networks and single consumer</a><a id="Setup-with-shared-networks-and-single-consumer-1"></a><a class="docs-heading-anchor-permalink" href="#Setup-with-shared-networks-and-single-consumer" title="Permalink"></a></h2><p><img src="../shared.png" alt="Simple Setup"/></p><h2 id="Setup-with-single-shared-network-and-multiple-consumers"><a class="docs-heading-anchor" href="#Setup-with-single-shared-network-and-multiple-consumers">Setup with single shared network and multiple consumers</a><a id="Setup-with-single-shared-network-and-multiple-consumers-1"></a><a class="docs-heading-anchor-permalink" href="#Setup-with-single-shared-network-and-multiple-consumers" title="Permalink"></a></h2><p><img src="../shared_advanced.png" alt="Advanced Setup"/></p><h2 id="Getting-internet-access"><a class="docs-heading-anchor" href="#Getting-internet-access">Getting internet access</a><a id="Getting-internet-access-1"></a><a class="docs-heading-anchor-permalink" href="#Getting-internet-access" title="Permalink"></a></h2><p>Machines contained in a shared network can access the internet with different scenarios:</p><ul><li>if they have an own firewall: this is internet accessibility, as common (check whether all traffic gets routed through it!)</li><li>if they don&#39;t have an own firewall, an external HTTP proxy is needed that has an endpoint exposed as Service Type NodePort</li></ul></article><nav class="docs-footer"><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.7.0 on <span class="colophon-date" title="Monday 7 July 2025 09:09">Monday 7 July 2025</span>. Using Julia version 1.9.4.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
