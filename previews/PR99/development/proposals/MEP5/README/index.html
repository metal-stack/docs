<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Shared Networks · metal-stack</title><script data-outdated-warner src="../../../../assets/warner.js"></script><link rel="canonical" href="https://docs.metal-stack.io/development/proposals/MEP5/README/"/><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.039/juliamono-regular.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.11/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../../../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../../../assets/documenter.js"></script><script src="../../../../siteinfo.js"></script><script src="../../../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../../../assets/themeswap.js"></script><link href="../../../../assets/favicon.ico" rel="icon" type="image/x-icon"/><link href="../../../../assets/youtube.css" rel="stylesheet" type="text/css"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../../../"><img src="../../../../assets/logo.svg" alt="metal-stack logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../../../">metal-stack</a></span></div><form class="docs-search" action="../../../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../../../">Introduction</a></li><li><span class="tocitem">Overview</span><ul><li><a class="tocitem" href="../../../../overview/architecture/">Architecture</a></li><li><a class="tocitem" href="../../../../overview/networking/">Networking</a></li><li><a class="tocitem" href="../../../../overview/hardware/">Hardware Support</a></li><li><a class="tocitem" href="../../../../overview/os/">Operating Systems</a></li><li><a class="tocitem" href="../../../../overview/kubernetes/">Kubernetes Integration</a></li><li><a class="tocitem" href="../../../../overview/storage/">Storage</a></li><li><a class="tocitem" href="../../../../overview/comparison/">Comparison</a></li></ul></li><li><a class="tocitem" href="../../../../quickstart/">Quickstart</a></li><li><span class="tocitem">Installation &amp; Administration</span><ul><li><a class="tocitem" href="../../../../installation/deployment/">Installation</a></li><li><a class="tocitem" href="../../../../installation/monitoring/">Monitoring</a></li><li><a class="tocitem" href="../../../../installation/troubleshoot/">Troubleshoot</a></li></ul></li><li><span class="tocitem">User Guides</span><ul><li><a class="tocitem" href="../../../../external/mini-lab/README/">mini-lab</a></li><li><a class="tocitem" href="../../../../external/metalctl/README/">metalctl</a></li><li><a class="tocitem" href="../../../../external/csi-driver-lvm/README/">csi-driver-lvm</a></li><li><a class="tocitem" href="../../../../external/firewall-controller/README/">firewall-controller</a></li></ul></li><li><a class="tocitem" href="../../../../apidocs/apidocs/">API Documentation</a></li><li><span class="tocitem">Development</span><ul><li><a class="tocitem" href="../../../client_libraries/">Client Libraries</a></li><li><a class="tocitem" href="../../../roadmap/">Roadmap</a></li><li><a class="tocitem" href="../../">Enhancement Proposals</a></li><li><a class="tocitem" href="../../../contributing/">Contributing</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Shared Networks</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Shared Networks</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/metal-stack/docs/blob/master/docs/src/development/proposals/MEP5/README.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Shared-Networks"><a class="docs-heading-anchor" href="#Shared-Networks">Shared Networks</a><a id="Shared-Networks-1"></a><a class="docs-heading-anchor-permalink" href="#Shared-Networks" title="Permalink"></a></h1><h2 id="Why-are-shared-networks-needed"><a class="docs-heading-anchor" href="#Why-are-shared-networks-needed">Why are shared networks needed</a><a id="Why-are-shared-networks-needed-1"></a><a class="docs-heading-anchor-permalink" href="#Why-are-shared-networks-needed" title="Permalink"></a></h2><p>For special purpose machines that serve shared services with performance critical workloads to all machines of a partition (like persistent storage) it would be good to have kind of a &quot;shared network&quot; that is easily accessible. They do not necessarily need another firewall. This would avoid having two firewalls in the datapath between a machine in a private network and the machines of a shared service.</p><h2 id="Constraints-that-need-to-hold"><a class="docs-heading-anchor" href="#Constraints-that-need-to-hold">Constraints that need to hold</a><a id="Constraints-that-need-to-hold-1"></a><a class="docs-heading-anchor-permalink" href="#Constraints-that-need-to-hold" title="Permalink"></a></h2><ul><li>a shared network is usable from all machines that have a firewall in front, that uses it</li><li>a shared network is only usable within a single partition (currently we are constrained in bandwidth and have no routing of 10.0.0.0/8 addresses btw. partitions and failure domain should be the partition but this constraint might get lifted in the future)</li><li>networks may be marked as shared after network allocation (but there should be no way back from shared to unshared)</li><li>neither machines nor firewalls may have multiple private, unshared networks configured</li><li>machines must have a single primary network configured<ul><li>this might be a shared network</li><li>OR a plain, unshared private network</li></ul></li><li>firewalls may participate in multiple shared networks</li><li>machines can be allocated with a primary network using auto IP allocation or with <code>noauto</code> and a specific IP</li></ul><h2 id="Should-shared-networks-be-private"><a class="docs-heading-anchor" href="#Should-shared-networks-be-private">Should shared networks be private</a><a id="Should-shared-networks-be-private-1"></a><a class="docs-heading-anchor-permalink" href="#Should-shared-networks-be-private" title="Permalink"></a></h2><p><strong>Alternative 1:</strong> If we implemented shared networks by extending functions around plain, private networks we would not have to manage another CIDR (mini point) and it would be possible to create a k8s cluster with a private network, mark the network as <code>shared</code> and produce shared services from this k8s cluster.</p><p><strong>Alternative 2:</strong> If shared networks are implemented as first class networks we could customize the VRF and also accomplish an other goal of our roadmap: being able to create machines directly in an external network.</p><p>Together with @majst01 and @Gerrit91 we decided to continue to implement  <strong>Alternative 1</strong>.</p><h2 id="Firewalls-accessing-a-shared-network"><a class="docs-heading-anchor" href="#Firewalls-accessing-a-shared-network">Firewalls accessing a shared network</a><a id="Firewalls-accessing-a-shared-network-1"></a><a class="docs-heading-anchor-permalink" href="#Firewalls-accessing-a-shared-network" title="Permalink"></a></h2><p>Firewalls that access shared networks need to:</p><ul><li>hide the private network behind an ip address of the shared network if the shared network was configured with <code>nat=true</code>.</li><li>import the prefixes of the shared VRF to the private VRF and import the prefixes of the private VRF to the shared VRF so that the communication between the two is working in both directions. As long as no <code>nat=true</code> was set on the shared VRF, the original machine ips are visible in both communication directions.</li></ul><h2 id="Setup-with-shared-networks-and-single-consumer"><a class="docs-heading-anchor" href="#Setup-with-shared-networks-and-single-consumer">Setup with shared networks and single consumer</a><a id="Setup-with-shared-networks-and-single-consumer-1"></a><a class="docs-heading-anchor-permalink" href="#Setup-with-shared-networks-and-single-consumer" title="Permalink"></a></h2><p><img src="../shared.png" alt="Simple Setup"/></p><h2 id="Setup-with-single-shared-network-and-multiple-consumers"><a class="docs-heading-anchor" href="#Setup-with-single-shared-network-and-multiple-consumers">Setup with single shared network and multiple consumers</a><a id="Setup-with-single-shared-network-and-multiple-consumers-1"></a><a class="docs-heading-anchor-permalink" href="#Setup-with-single-shared-network-and-multiple-consumers" title="Permalink"></a></h2><p><img src="../shared_advanced.png" alt="Advanced Setup"/></p><h2 id="Getting-internet-acccess"><a class="docs-heading-anchor" href="#Getting-internet-acccess">Getting internet acccess</a><a id="Getting-internet-acccess-1"></a><a class="docs-heading-anchor-permalink" href="#Getting-internet-acccess" title="Permalink"></a></h2><p>Machines contained in a shared network can access the internet with different scenarios:</p><ul><li>if they have an own firewall: this is internet accessibility, as common (check whether all traffic gets routed through it!)</li><li>if they don&#39;t have an own firewall, an external HTTP proxy is needed that has an endpoint exposed as Service Type NodePort</li></ul></article><nav class="docs-footer"><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.10 on <span class="colophon-date" title="Saturday 11 June 2022 19:25">Saturday 11 June 2022</span>. Using Julia version 1.6.1.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
